"use strict";(self.webpackChunklumos_data_platform=self.webpackChunklumos_data_platform||[]).push([[290],{48720:function(ca,At,s){s.r(At),s.d(At,{default:function(){return Yn}});var sn=s(19632),Mt=s.n(sn),ln=s(15009),F=s.n(ln),cn=s(99289),ae=s.n(cn),un=s(5574),C=s.n(un),dn=s(90930),Lt=s(17294),G=s(92016),x=s(45360),It=s(40411),ge=s(4393),Ve=s(26412),Re=s(71230),k=s(15746),r=s(67294),pe=s(74250);function gn(){return mt.apply(this,arguments)}function mt(){return mt=ae()(F()().mark(function v(){return F()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,G.request)("/api/profile/basic"));case 1:case"end":return a.stop()}},v)})),mt.apply(this,arguments)}function ua(){return St.apply(this,arguments)}function St(){return St=_asyncToGenerator(_regeneratorRuntime().mark(function v(){return _regeneratorRuntime().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",request("/api/v1/status"));case 1:case"end":return a.stop()}},v)})),St.apply(this,arguments)}function da(){return Ct.apply(this,arguments)}function Ct(){return Ct=_asyncToGenerator(_regeneratorRuntime().mark(function v(){return _regeneratorRuntime().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",request("/test/api/v0/data",{method:"GET"}));case 1:case"end":return a.stop()}},v)})),Ct.apply(this,arguments)}function ga(v){return yt.apply(this,arguments)}function yt(){return yt=_asyncToGenerator(_regeneratorRuntime().mark(function v(n){var a,d,y,b;return _regeneratorRuntime().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,request("http://127.0.0.1:8000/api/v0/hdf5/list",{method:"GET",params:{current:(a=n==null?void 0:n.current)!==null&&a!==void 0?a:1,pageSize:(d=n==null?void 0:n.pageSize)!==null&&d!==void 0?d:10,keyword:(y=n==null?void 0:n.keyword)!==null&&y!==void 0?y:""}});case 2:return b=h.sent,h.abrupt("return",b);case 4:case"end":return h.stop()}},v)})),yt.apply(this,arguments)}function pa(v){var n=encodeURIComponent(v);return"http://127.0.0.1:8000/api/v0/hdf5/download?name=".concat(n)}function fa(){return jt.apply(this,arguments)}function jt(){return jt=_asyncToGenerator(_regeneratorRuntime().mark(function v(){var n;return _regeneratorRuntime().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,request("/config.json",{method:"GET"});case 2:return n=d.sent,d.abrupt("return",n);case 4:case"end":return d.stop()}},v)})),jt.apply(this,arguments)}var pn=s(9783),bt=s.n(pn),fn=s(28846),vn=(0,fn.kc)(function(v){var n=v.token;return{title:{marginBottom:"16px",color:n.colorTextHeading,fontWeight:"500",fontSize:"16px"},headerInfo:bt()({position:"relative",textAlign:"center","& > span":{display:"inline-block",marginBottom:"4px",color:n.colorTextSecondary,fontSize:n.fontSize,lineHeight:"22px"},"& > p":{margin:"0",color:n.colorTextHeading,fontSize:"24px",lineHeight:"32px"},"& > em":{position:"absolute",top:"0",right:"0",width:"1px",height:"56px",backgroundColor:n.colorSplit}},"@media screen and (max-width: ".concat(n.screenSM,"px)"),{marginBottom:"16px","& > em":{display:"none"}}),linearGradientButton:{"> span":{position:"relative"},"&::before":{content:"''",background:"linear-gradient(135deg, #6253e1, #04befe)",position:"absolute",inset:"-1px",opacity:1,transition:"all 0.3s",borderRadius:"inherit"},"&:hover::before":{opacity:0}},loadingMask:{position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",color:"white",textAlign:"center"}}}),xt=vn,hn=s(97857),Xe=s.n(hn),mn=s(4913),Sn=s(60933),e=s(85893),Cn=function(n){var a=n.color,d=a===void 0?16711680:a,y=n.shaftRadius,b=y===void 0?.003:y,R=n.shaftLength,h=R===void 0?.07:R,P=n.headRadius,I=P===void 0?.005:P,U=n.headLength,H=U===void 0?.03:U,E=n.opacity,O=E===void 0?0:E,V=h+H;return(0,e.jsxs)("group",{rotation:[Math.PI/2,0,0],children:[(0,e.jsxs)("mesh",{position:[0,h/2,0],children:[(0,e.jsx)("cylinderGeometry",{args:[b,b,h,32]}),(0,e.jsx)("meshBasicMaterial",{color:d,transparent:!0,opacity:O,side:pe.ehD})]}),(0,e.jsxs)("mesh",{position:[0,h+H/2,0],children:[(0,e.jsx)("coneGeometry",{args:[I,H,32]}),(0,e.jsx)("meshBasicMaterial",{color:d,transparent:!0,opacity:O,side:pe.ehD})]})]})},Ot=Cn,yn=(0,r.memo)(function(v){var n=v.pose,a=v.color,d=v.opacity;return(0,e.jsx)("group",{position:n.position,quaternion:n.quaternion,scale:.9,children:(0,e.jsx)(Ot,{color:a,shaftRadius:.003,shaftLength:.07,headRadius:.005,headLength:.03,opacity:d})})}),jn=yn,bn=function(n){var a=n.currentPose,d=n.history,y=n.trajectoryLength,b=(0,r.useRef)(null),R=new pe.Ilk(16711680),h=1;return(0,r.useEffect)(function(){!a||!b.current||(b.current.position.copy(a.position).multiplyScalar(h),b.current.quaternion.copy(a.quaternion))},[a]),(0,e.jsxs)(Sn.Xz,{camera:{position:[.25,.25,.5],fov:70},gl:{preserveDrawingBuffer:!0},children:[(0,e.jsx)("ambientLight",{intensity:.6}),(0,e.jsx)("directionalLight",{position:[10,10,5],intensity:1,castShadow:!0}),(0,e.jsx)("gridHelper",{args:[5,50]}),(0,e.jsx)("axesHelper",{args:[5]}),d.map(function(P,I){console.log(I);var U=(I+1)/Math.min(d.length,y),H=R.clone().multiplyScalar(U),E=.2+U*.8,O=Xe()(Xe()({},P),{},{position:new pe.Pa4().copy(P.position).multiplyScalar(h)});return(0,e.jsx)(jn,{pose:O,color:16711680,opacity:E},"history-arrow-".concat(I))}),a&&(0,e.jsxs)("group",{ref:b,children:[(0,e.jsx)("axesHelper",{args:[.1]}),(0,e.jsx)(Ot,{color:16711680,shaftRadius:.003,shaftLength:.07,headRadius:.005,headLength:.03})]}),(0,e.jsx)(mn.z,{enableDamping:!0,dampingFactor:.05,enableZoom:!0,enablePan:!0})]})},Et=bn,re={wrapper:"wrapper___PkEK_",listContainer:"listContainer___o7zbn",itemContainer:"itemContainer___AKCPD",selected:"selected___sbaet",itemTitle:"itemTitle___AiHnz",itemDesc:"itemDesc___Ww6vs",itemImgWrap:"itemImgWrap___IE41u",disabled:"disabled___lQ3Ok",itemImg:"itemImg___Z7aws",itemInfo:"itemInfo___cRBoQ",selectedMarker:"selectedMarker___wDF94",scaleIn:"scaleIn___DodMH"},xn=s(93967),Rn=s.n(xn),K=function(v){return v.Portable="Portable",v.FullFunction="FullFunction",v}({}),wn=s.p+"static/fastumipro1.5cbb908d.png",kn=s.p+"static/product-full.f87f1597.png",Wt=[{title:(0,G.formatMessage)({id:"pages.dataCollection.portableVersion"}),description:(0,G.formatMessage)({id:"pages.dataCollection.portableVersion"}),url:wn,value:K.Portable,apiBasePrefix:"/portable"},{title:(0,G.formatMessage)({id:"pages.dataCollection.fullFunctionVersion"}),description:(0,G.formatMessage)({id:"pages.dataCollection.fullFunctionVersion"}),url:kn,value:K.FullFunction,apiBasePrefix:"/pro"}],Pn=function(n){var a=n.value,d=a===void 0?K.Portable:a,y=n.onChange,b=n.disabled,R=(0,G.useIntl)(),h=function(I){b||y&&y(I)};return(0,e.jsx)("div",{className:re.wrapper,children:(0,e.jsx)(ge.Z,{style:{marginTop:0},title:R.formatMessage({id:"pages.dataCollection.version"}),children:(0,e.jsx)("div",{className:re.listContainer,children:Wt.map(function(P){var I=d===P.value;return(0,e.jsxs)("div",{className:Rn()(re.itemContainer,bt()(bt()({},re.selected,I),re.disabled,b&&!I)),onClick:function(){return h(P.value)},children:[(0,e.jsx)("div",{className:re.itemImgWrap,children:(0,e.jsx)("img",{src:P.url,alt:P.title,className:re.itemImg})}),(0,e.jsx)("div",{className:re.itemInfo,children:(0,e.jsx)("h3",{className:re.itemTitle,children:P.title})}),I&&(0,e.jsx)("div",{className:re.selectedMarker})]},P.value)})})})})},Dn=Pn,Nt=(0,r.createContext)({}),Tn=Nt.Provider,va=function(){return useContext(Nt)},Zn=s(80882),Fn=s(48115),An=s(28280),Bt=s(18429),Mn=s(36027),Ln=s(9798),L=s(83622),$t=s(34041),In=s(96074),Ye=s(42119),On=s(85576),En=s(74330),we={countdownWrapper:"countdownWrapper___qaa5S",numberWrapper:"numberWrapper___BduAc",animate:"animate___IOp3D",scaleAnimation:"scaleAnimation___PUFVj"},Wn=s(75697),Nn=function(n){var a=n.totalSeconds,d=a===void 0?3:a,y=n.triggerCountdown,b=n.onComplete,R=n.showAnimation,h=R===void 0?!0:R,P=n.animationScale,I=P===void 0?1.5:P,U=n.animationDuration,H=U===void 0?.5:U,E=n.textColor,O=E===void 0?"#04befe":E,V=n.backgroundColor,ie=V===void 0?"rgba(255, 255, 255, 0.9)":V,ke=n.showCircleBackground,fe=ke===void 0?!0:ke,Ee=(0,r.useState)(!1),J=C()(Ee,2),q=J[0],Pe=J[1],We=(0,r.useState)(!1),i=C()(We,2),Ne=i[0],Se=i[1],m=(0,r.useState)(d),Ce=C()(m,2),oe=Ce[0],ve=Ce[1],ye=(0,r.useState)(),je=C()(ye,2),Je=je[0],Be=je[1],se=(0,r.useRef)(d),_=(0,r.useRef)(null),M=(0,Wn.Z)({targetDate:Je,onEnd:function(){b==null||b(),Pe(!1),Se(!1)}}),$e=C()(M,1),ze=$e[0];(0,r.useEffect)(function(){var j=Math.round(ze/1e3);j!==se.current&&j>=0&&j<=d&&(ve(j),h&&_.current&&(_.current.classList.remove(we.animate),_.current.offsetWidth,_.current.classList.add(we.animate)),se.current=j)},[ze,d,h]),(0,r.useEffect)(function(){y&&!q&&(Pe(!0),Se(!0),ve(d),se.current=d,Be(new Date().getTime()+d*1e3))},[y,q,d]);var De=(0,r.useCallback)(function(){oe===0&&_.current&&_.current.classList.add(we.final)},[oe]),Te=(0,r.useCallback)(function(j){return j===0?"Go!":j.toString()},[]),le=(0,r.useCallback)(function(){return oe===0?"140px":"120px"},[oe]),Ze=(0,r.useCallback)(function(){var j={};return O&&(j.color=O),ie&&fe&&(j.background=ie),j},[O,ie,fe]);return q?(0,e.jsx)("div",{className:we.countdownWrapper,style:{backgroundColor:"rgba(0, 0, 0, 0.7)"},children:(0,e.jsx)("div",{ref:_,className:"".concat(we.numberWrapper," ").concat(Ne?we.animating:""),style:Xe()(Xe()({fontSize:le()},Ze()),{},{"--animation-scale":I,"--animation-duration":"".concat(H,"s")}),onAnimationEnd:De,children:Te(oe)})}):null},Bn=Nn,$n=s(96486),me=s.n($n),Ae=Ln.Z.Text,zn="localhost",Un="8887",Hn="v0",Rt="http://".concat(zn,":").concat(Un,"/api/").concat(Hn),zt=5,Qn=function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return new Promise(function(a){setTimeout(function(){a(!0)},n)})},Me=function(n){var a=n.title,d=n.value,y=n.bordered,b=xt(),R=b.styles;return(0,e.jsxs)("div",{className:R.headerInfo,children:[(0,e.jsx)("span",{children:a}),(0,e.jsx)("p",{children:d}),y&&(0,e.jsx)("em",{})]})},Gn=function(n){var a=n.connect,d=n.connOk,y=n.version,b=n.isStarting,R=n.deviceStarted,h=n.recording,P=n.connMode,I=n.leftSN,U=n.rightSN,H=n.currentStep,E=n.setLeftSN,O=n.setRightSN,V=n.setRecording,ie=n.setConnect,ke=n.setConnMode,fe=n.setVersion,Ee=n.setConnOk,J=n.setIsStarting,q=n.setDeviceStarted,Pe=n.setCurrentStep,We=(0,G.useIntl)(),i=We.formatMessage,Ne=xt(),Se=Ne.styles,m=(0,r.useState)(!1),Ce=C()(m,2),oe=Ce[0],ve=Ce[1],ye=(0,r.useState)(""),je=C()(ye,2),Je=je[0],Be=je[1],se=(0,r.useState)(!1),_=C()(se,2),M=_[0],$e=_[1],ze=(0,r.useState)(!1),De=C()(ze,2),Te=De[0],le=De[1],Ze=(0,r.useState)(!1),j=C()(Ze,2),ee=j[0],qe=j[1],te=(0,r.useMemo)(function(){var g,f=(g=me().find(Wt,{value:y}))===null||g===void 0?void 0:g.apiBasePrefix;return console.log("\u5F53\u524D\u7248\u672CAPI\u524D\u7F00\uFF1A",f),"".concat(Rt).concat(f)},[y]),Ue=function(){var g=ae()(F()().mark(function f(){var p,o,S,t;return F()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.prev=0,u.next=3,fetch("".concat(Rt,"/pairing/config"),{method:"GET"});case 3:return p=u.sent,u.next=6,p.json();case 6:if(o=u.sent,console.log("\u52A0\u8F7D\u672C\u5730\u914D\u7F6E:",o),!(o!=null&&o.devices)){u.next=12;break}return E(((S=o.devices.device_0)===null||S===void 0?void 0:S.xv_serial)||""),O(((t=o.devices.device_1)===null||t===void 0?void 0:t.xv_serial)||""),u.abrupt("return",!0);case 12:return u.abrupt("return",!1);case 15:return u.prev=15,u.t0=u.catch(0),console.error("\u83B7\u53D6\u8BBE\u5907\u914D\u7F6E\u5931\u8D25:",u.t0),u.abrupt("return",!1);case 19:case"end":return u.stop()}},f,null,[[0,15]])}));return function(){return g.apply(this,arguments)}}(),_e=function(){var g=ae()(F()().mark(function f(){var p,o,S,t;return F()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.prev=0,u.next=3,fetch("".concat(Rt,"/status"),{method:"GET"});case 3:return p=u.sent,u.next=6,p.json();case 6:return o=u.sent,S=o.xv,t=o.device_version||"Unknown",t==="pro"?fe(K.FullFunction):t==="portable"&&fe(K.Portable),S==="RUNNING"?(q(!0),J(!1)):["STOPPED","CRASHED","STARTUP_FAILED"].includes(S)?(q(!1),J(!1)):S==="STARTING"&&(J(!0),q(!1),x.ZP.warning("\u8BBE\u5907\u542F\u52A8\u4E2D\uFF0C\u8BF7\u7A0D\u7B49\u540E\u5237\u65B0\u9875\u9762",3)),u.abrupt("return",!0);case 14:return u.prev=14,u.t0=u.catch(0),console.error("\u83B7\u53D6\u8BBE\u5907\u72B6\u6001\u5931\u8D25:",u.t0),u.abrupt("return",!1);case 18:case"end":return u.stop()}},f,null,[[0,14]])}));return function(){return g.apply(this,arguments)}}(),ce=function(){var g=ae()(F()().mark(function f(){var p,o;return F()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(te){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,t.next=5,fetch("".concat(te,"/recording/status"),{method:"GET"});case 5:if(p=t.sent,!p.ok){t.next=12;break}return t.next=9,p.json();case 9:o=t.sent,console.log("\u540C\u6B65\u5F55\u5236\u72B6\u6001:",o),o.is_recording!==void 0&&V(o.is_recording);case 12:t.next=17;break;case 14:t.prev=14,t.t0=t.catch(2),console.error("\u83B7\u53D6\u5F55\u5236\u72B6\u6001\u5931\u8D25:",t.t0);case 17:case"end":return t.stop()}},f,null,[[2,14]])}));return function(){return g.apply(this,arguments)}}();(0,r.useEffect)(function(){Ue(),_e(),ce()},[]),(0,r.useEffect)(function(){R&&ce()},[te,R]);var wt=function(){var g=ae()(F()().mark(function f(){var p,o,S,t,N,u;return F()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return qe(!0),l.prev=1,l.next=4,fetch("".concat(te,"/pairing/quick_run"),{method:"POST"});case 4:return p=l.sent,l.next=7,p.json();case 7:if(o=l.sent,!(!p.ok||!o.success)){l.next=10;break}throw new Error((o==null?void 0:o.message)||(o==null||(S=o.detail)===null||S===void 0?void 0:S.message)||"\u914D\u5BF9\u5931\u8D25");case 10:if(x.ZP.success(o.message||"\u914D\u5BF9\u6210\u529F\uFF01\u914D\u7F6E\u5DF2\u66F4\u65B0"),!o.data){l.next=16;break}E(((t=o.data.device_0)===null||t===void 0?void 0:t.xv_serial)||""),O(((N=o.data.device_1)===null||N===void 0?void 0:N.xv_serial)||""),l.next=18;break;case 16:return l.next=18,Ue();case 18:l.next=27;break;case 20:return l.prev=20,l.t0=l.catch(1),x.ZP.warning(i({id:"pages.dataCollection.warning.pairingException"},{error:l.t0.message}),3),l.next=25,Ue();case 25:u=l.sent,u?x.ZP.success("\u5DF2\u52A0\u8F7D\u672C\u5730\u5386\u53F2\u914D\u7F6E"):x.ZP.error("\u65E0\u6CD5\u8FDE\u63A5\u670D\u52A1\u6216\u672C\u5730\u914D\u7F6E\u4E3A\u7A7A");case 27:return l.prev=27,qe(!1),le(!1),l.finish(27);case 31:case"end":return l.stop()}},f,null,[[1,20,27,31]])}));return function(){return g.apply(this,arguments)}}(),et=function(){var g=ae()(F()().mark(function f(){var p,o;return F()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(R){t.next=3;break}return x.ZP.warning(i({id:"pages.dataCollection.warning.deviceNotStarted"}),2),t.abrupt("return");case 3:return t.prev=3,x.ZP.loading("\u6B63\u5728\u53D1\u9001\u4E2D\u65AD\u6307\u4EE4\uFF0C\u6E05\u7406\u8FDB\u7A0B...",2),t.next=7,fetch("".concat(te,"/device/stop"),{method:"POST"});case 7:return p=t.sent,t.next=10,p.json();case 10:if(o=t.sent,!p.ok){t.next=19;break}x.ZP.success("\u8BBE\u5907\u5DF2\u6210\u529F\u4E2D\u65AD\uFF1A".concat(o.message),3),ie(!1),q(!1),Ee(!1),ke("idle"),t.next=20;break;case 19:throw new Error(o.detail||"\u4E2D\u65AD\u8BF7\u6C42\u88AB\u62D2\u7EDD");case 20:t.next=25;break;case 22:t.prev=22,t.t0=t.catch(3),x.ZP.error("\u8BBE\u5907\u4E2D\u65AD\u5931\u8D25\uFF1A".concat((t.t0===null||t.t0===void 0?void 0:t.t0.message)||t.t0),4);case 25:case"end":return t.stop()}},f,null,[[3,22]])}));return function(){return g.apply(this,arguments)}}(),tt=function(){var g=ae()(F()().mark(function f(){var p,o;return F()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!a){t.next=3;break}return x.ZP.warning(i({id:"pages.dataCollection.warning.disconnectBeforeRestart"}),3),t.abrupt("return");case 3:return J(!0),t.prev=4,x.ZP.loading(i({id:"pages.dataCollection.loading.deviceStartWarning"}),1),t.next=8,fetch("".concat(te,"/device/start"),{method:"POST"});case 8:return p=t.sent,t.next=11,p.json();case 11:if(o=t.sent,!p.ok){t.next=17;break}x.ZP.success("\u6307\u4EE4\u53D1\u9001\u6210\u529F\uFF1A".concat(o.message||"\u6B63\u5728\u521D\u59CB\u5316..."),3),q(!0),t.next=18;break;case 17:throw new Error(o.detail||"\u542F\u52A8\u8BF7\u6C42\u88AB\u62D2\u7EDD");case 18:t.next=24;break;case 20:t.prev=20,t.t0=t.catch(4),x.ZP.error("\u542F\u52A8\u5931\u8D25\uFF1A".concat((t.t0===null||t.t0===void 0?void 0:t.t0.message)||t.t0),4),q(!1);case 24:return t.prev=24,J(!1),t.finish(24);case 27:case"end":return t.stop()}},f,null,[[4,20,24,27]])}));return function(){return g.apply(this,arguments)}}(),he=(0,r.useMemo)(function(){return i(a?d?P==="sse"?{id:"pages.dataCollection.operation.statusMonitoring.connectedStatus.connected"}:P==="poll"?{id:"pages.dataCollection.operation.statusMonitoring.connectedStatus.connected"}:{id:"pages.dataCollection.operation.statusMonitoring.connectedStatus.connected"}:{id:"pages.dataCollection.operation.statusMonitoring.connectedStatus.connecting"}:{id:"pages.dataCollection.operation.statusMonitoring.connectedStatus.unconnected"})},[a,d,P]),W=(0,r.useCallback)(function(){ie(!a)},[a]),ue=function(){var g=ae()(F()().mark(function f(){var p,o;return F()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return ve(!0),t.next=3,Qn(zt*1e3);case 3:return console.log("\u5F00\u59CB\u91C7\u96C6\uFF1A",new Date().toLocaleTimeString()),t.prev=4,t.next=7,fetch("".concat(te,"/recording/start"),{method:"POST"});case 7:return p=t.sent,t.next=10,p.json();case 10:o=t.sent,p!=null&&p.ok?(V(!0),x.ZP.success("\u5F00\u59CB\u91C7\u96C6\uFF0C\u6587\u4EF6\uFF1A".concat(o.message||""))):x.ZP.error("\u5F00\u59CB\u91C7\u96C6\u5931\u8D25"),t.next=17;break;case 14:t.prev=14,t.t0=t.catch(4),x.ZP.error("\u5F00\u59CB\u91C7\u96C6\u5F02\u5E38\uFF1A".concat((t.t0===null||t.t0===void 0?void 0:t.t0.message)||t.t0));case 17:case"end":return t.stop()}},f,null,[[4,14]])}));return function(){return g.apply(this,arguments)}}(),nt=function(){var g=ae()(F()().mark(function f(){var p,o,S,t,N,u;return F()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!M){l.next=2;break}return l.abrupt("return");case 2:return $e(!0),l.prev=3,x.ZP.loading(i({id:"pages.dataCollection.loading.stopCollectionWarning"}),2),l.next=7,fetch("".concat(te,"/recording/stop"),{method:"POST"});case 7:return p=l.sent,l.next=10,p.json();case 10:o=l.sent,o.code===0?(V(!1),S=o.data||{},t=S.leftPath,N=S.rightPath,u=o.msg||"\u505C\u6B62\u6210\u529F",console.log("\u6570\u636E\u4FDD\u5B58\u8DEF\u5F84:",{leftPath:t,rightPath:N}),x.ZP.success("".concat(u))):x.ZP.error(o.msg||"\u505C\u6B62\u5F55\u5236\u5931\u8D25"),l.next=18;break;case 14:l.prev=14,l.t0=l.catch(3),console.error(l.t0),x.ZP.error("\u505C\u6B62\u8BF7\u6C42\u5F02\u5E38\uFF1A".concat((l.t0===null||l.t0===void 0?void 0:l.t0.message)||l.t0));case 18:return l.prev=18,$e(!1),l.finish(18);case 21:case"end":return l.stop()}},f,null,[[3,14,18,21]])}));return function(){return g.apply(this,arguments)}}();(0,r.useEffect)(function(){var g=function(o){if(!(o instanceof HTMLElement))return!1;var S=o.tagName.toLowerCase();return S==="input"||S==="textarea"||o.isContentEditable},f=function(o){if(!o.repeat&&!g(o.target)){var S=o.key.toLowerCase();if(S===" "||S==="spacebar"){if(o.preventDefault(),M)return;a?a&&!h&&W():W()}if(S==="y"){if(M)return;a&&!h?ue():h&&nt()}}};return window.addEventListener("keydown",f),function(){window.removeEventListener("keydown",f)}},[a,h,M]);var at=(0,r.useState)(!1),rt=C()(at,2),Fe=rt[0],kt=rt[1],it=function(){return console.log("1. \u67E5\u770B\u8FDE\u63A5\u7684\u72B6\u6001")},Pt=function(){return console.log("2. \u542F\u52A8ROS")},ot=function(){return console.log("3. \u542F\u52A8xvisio")},Dt=function(){return console.log("4. \u626B\u63CF\u53EF\u7528\u57FA\u7AD9")},st=function(){return console.log("5. \u6807\u5B9A")},Tt=function(){return console.log("6. \u53D1\u5E03\u57FA\u7AD9\u6570\u636E")},lt=function(){return console.log("7. \u505C\u6389\u6240\u6709\u5305\u62ECROS\u670D\u52A1")},Ht=(0,r.useMemo)(function(){return y===K.FullFunction},[y]),ct=function(){return null;switch(y){case K.FullFunction:return(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)(Re.Z,{gutter:[16,16],style:{marginTop:16},children:[(0,e.jsx)(k.Z,{span:6,children:(0,e.jsx)(L.ZP,{style:{width:"100%"},onClick:it,children:"\u67E5\u770B\u8FDE\u63A5\u72B6\u6001"})}),(0,e.jsx)(k.Z,{span:6,children:(0,e.jsx)(L.ZP,{style:{width:"100%"},onClick:Pt,children:"\u542F\u52A8ROS"})}),(0,e.jsx)(k.Z,{span:6,children:(0,e.jsx)(L.ZP,{style:{width:"100%"},onClick:ot,children:"\u542F\u52A8xvisio"})}),(0,e.jsx)(k.Z,{span:6,children:(0,e.jsx)(L.ZP,{style:{width:"100%"},onClick:Dt,children:"\u626B\u63CF\u53EF\u7528\u57FA\u7AD9"})}),(0,e.jsx)(k.Z,{span:6,children:(0,e.jsx)(L.ZP,{style:{width:"100%"},onClick:st,children:"\u6807\u5B9A"})}),(0,e.jsx)(k.Z,{span:6,children:(0,e.jsx)(L.ZP,{style:{width:"100%"},onClick:Tt,children:"\u53D1\u5E03\u57FA\u7AD9\u6570\u636E"})}),(0,e.jsx)(k.Z,{span:6,children:(0,e.jsx)(L.ZP,{danger:!0,style:{width:"100%"},onClick:lt,children:"\u505C\u6389\u6240\u6709\u670D\u52A1"})})]})});case K.Portable:return(0,e.jsx)(e.Fragment,{});default:return(0,e.jsx)(e.Fragment,{})}},Qt=function(){switch(y){case K.FullFunction:return(0,e.jsx)(e.Fragment,{});case K.Portable:return(0,e.jsx)(e.Fragment,{});default:return(0,e.jsx)(e.Fragment,{})}};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Bn,{totalSeconds:zt,triggerCountdown:oe,onComplete:function(){ve(!1)}}),(0,e.jsx)(ge.Z,{style:{marginTop:0},title:i({id:"pages.dataCollection.operation"}),extra:(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(L.ZP,{type:"text",icon:Fe?(0,e.jsx)(Zn.Z,{}):(0,e.jsx)(Fn.Z,{}),onClick:function(){return kt(!Fe)}})}),children:!Fe&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(Re.Z,{gutter:[48,24],children:[(0,e.jsxs)(k.Z,{lg:12,md:24,sm:24,xs:24,children:[(0,e.jsx)(Ae,{style:{display:"block",marginBottom:16,color:"rgba(0, 0, 0, 0.45)"},children:i({id:"pages.dataCollection.operation.core"})}),(0,e.jsxs)(Re.Z,{gutter:[16,16],children:[(0,e.jsx)(k.Z,{span:12,children:R===!1?(0,e.jsx)(L.ZP,{type:"primary",icon:(0,e.jsx)(An.Z,{}),style:{width:"100%",background:"#52c41a",borderColor:"#52c41a"},onClick:tt,loading:b,disabled:a||h||M,children:i({id:"pages.dataCollection.operation.core.startDevice"})}):(0,e.jsx)(L.ZP,{danger:!0,type:"primary",icon:(0,e.jsx)(Bt.Z,{}),style:{width:"100%"},onClick:et,disabled:h||M,children:i({id:"pages.dataCollection.operation.core.stopDevice"})})}),(0,e.jsx)(k.Z,{span:12,children:a===!1?(0,e.jsx)(L.ZP,{type:"primary",icon:(0,e.jsx)(Mn.Z,{}),className:Se.linearGradientButton,style:{width:"100%",color:R?"#efefef":"#ffffff"},onClick:W,disabled:h||b||!R||M,children:i({id:"pages.dataCollection.operation.core.connectDevice"})}):(0,e.jsx)(L.ZP,{danger:!0,type:"primary",icon:(0,e.jsx)(Bt.Z,{}),style:{width:"100%"},onClick:W,disabled:h||M,children:i({id:"pages.dataCollection.operation.core.disconnectDevice"})})}),(0,e.jsx)(k.Z,{span:12,children:(0,e.jsx)(L.ZP,{type:"primary",style:{width:"100%"},onClick:ue,disabled:h||!a||M,children:i({id:"pages.dataCollection.operation.core.startCollection"})})}),(0,e.jsx)(k.Z,{span:12,children:(0,e.jsx)(L.ZP,{danger:!0,style:{width:"100%"},onClick:nt,disabled:!h,loading:M,children:i(M?{id:"pages.dataCollection.operation.core.saving"}:{id:"pages.dataCollection.operation.core.stopCollection"})})})]}),ct()]}),(0,e.jsxs)(k.Z,{lg:12,md:24,sm:24,xs:24,children:[(0,e.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[(0,e.jsx)(Ae,{style:{color:"rgba(0, 0, 0, 0.45)"},children:i({id:"pages.dataCollection.operation.deviceConfig"})}),(0,e.jsxs)(L.ZP,{type:"primary",size:"middle",ghost:!0,onClick:function(){return le(!0)},disabled:a||h||!R||M,children:["\u270B\u{1F3FB} ",i({id:"pages.dataCollection.operation.deviceConfig.autoPairing"})]})]}),(0,e.jsxs)(Re.Z,{gutter:[16,16],children:[(0,e.jsxs)(k.Z,{lg:12,md:12,sm:24,xs:24,children:[(0,e.jsx)(Ae,{strong:!0,children:i({id:"pages.dataCollection.operation.deviceConfig.leftHand"})}),(0,e.jsx)($t.Z,{style:{width:"100%",marginTop:8},placeholder:i({id:"pages.dataCollection.operation.deviceConfig.leftHandDesc"}),showSearch:!0,allowClear:!0,disabled:!0,value:I})]}),(0,e.jsxs)(k.Z,{lg:12,md:12,sm:24,xs:24,children:[(0,e.jsx)(Ae,{strong:!0,children:i({id:"pages.dataCollection.operation.deviceConfig.rightHand"})}),(0,e.jsx)($t.Z,{style:{width:"100%",marginTop:8},placeholder:i({id:"pages.dataCollection.operation.deviceConfig.rightHandDesc"}),showSearch:!0,allowClear:!0,disabled:!0,value:U})]})]})]})]}),(0,e.jsx)(In.Z,{style:{marginTop:24,marginBottom:24}}),(0,e.jsxs)("div",{children:[(0,e.jsx)(Ae,{style:{display:"block",marginBottom:16,color:"rgba(0, 0, 0, 0.45)"},children:"\u72B6\u6001\u76D1\u63A7"}),(0,e.jsxs)(Re.Z,{gutter:[16,16],align:"top",children:[(0,e.jsx)(k.Z,{lg:9,md:24,sm:24,xs:24,children:(0,e.jsxs)(Ye.Z,{current:H,size:"small",children:[(0,e.jsx)(Ye.Z.Step,{title:i({id:"pages.dataCollection.operation.statusMonitoring.unconnected"}),description:i({id:"pages.dataCollection.operation.statusMonitoring.unconnectedDesc"})}),(0,e.jsx)(Ye.Z.Step,{title:i({id:"pages.dataCollection.operation.statusMonitoring.connected"}),description:i({id:"pages.dataCollection.operation.statusMonitoring.connectedDesc"})}),(0,e.jsx)(Ye.Z.Step,{title:i({id:"pages.dataCollection.operation.statusMonitoring.collecting"}),description:i({id:"pages.dataCollection.operation.statusMonitoring.collectingDesc"})})]})}),(0,e.jsx)(k.Z,{lg:3,md:8,sm:12,xs:24,children:(0,e.jsx)(Me,{title:i({id:"pages.dataCollection.operation.statusMonitoring.connectedStatus"}),value:he,bordered:!0})}),y===K.FullFunction&&(0,e.jsx)(k.Z,{lg:3,md:8,sm:12,xs:24,children:(0,e.jsx)(Me,{title:i({id:"pages.dataCollection.operation.statusMonitoring.sensorStatus.laser"}),value:he,bordered:!0})}),(0,e.jsx)(k.Z,{lg:3,md:8,sm:12,xs:24,children:(0,e.jsx)(Me,{title:i({id:"pages.dataCollection.operation.statusMonitoring.sensorStatus.visualOdometry"}),value:he,bordered:!0})}),(0,e.jsx)(k.Z,{lg:3,md:8,sm:12,xs:24,children:(0,e.jsx)(Me,{title:i({id:"pages.dataCollection.operation.statusMonitoring.sensorStatus.videoStream"}),value:he,bordered:!0})}),(0,e.jsx)(k.Z,{lg:3,md:8,sm:12,xs:24,children:(0,e.jsx)(Me,{title:i({id:"pages.dataCollection.operation.statusMonitoring.sensorStatus.depthSensor"}),value:he,bordered:!0})})]})]})]})}),(0,e.jsx)(On.Z,{title:i({id:"pages.dataCollection.operation.deviceConfig.autoPairingGuide"}),centered:!0,open:Te,onCancel:function(){return!ee&&le(!1)},footer:[(0,e.jsx)(L.ZP,{onClick:function(){return le(!1)},disabled:ee,children:i({id:"pages.dataCollection.operation.deviceConfig.cancel"})},"cancel"),(0,e.jsx)(L.ZP,{type:"primary",loading:ee,onClick:wt,children:i(ee?{id:"pages.dataCollection.operation.deviceConfig.checking"}:{id:"pages.dataCollection.operation.deviceConfig.startPairing"})},"submit")],children:(0,e.jsx)("div",{style:{padding:"20px 0"},children:ee?(0,e.jsxs)("div",{style:{textAlign:"center"},children:[(0,e.jsx)(En.Z,{size:"large",tip:i({id:"pages.dataCollection.operation.deviceConfig.autoPairingGuideLogicDoubleDeviceAnalyzing"})}),(0,e.jsx)("div",{style:{marginTop:20,fontSize:16,fontWeight:"bold",color:"#1890ff"},children:i({id:"pages.dataCollection.operation.deviceConfig.shakeLeftHand"})}),(0,e.jsx)("div",{style:{marginTop:8,color:"#666"},children:i({id:"pages.dataCollection.operation.deviceConfig.skipIfSingleDevice"})})]}):(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{children:i({id:"pages.dataCollection.operation.deviceConfig.autoPairingGuideDesc"})}),(0,e.jsxs)("div",{style:{background:"#f5f5f5",padding:15,borderRadius:8},children:[(0,e.jsx)("p",{children:(0,e.jsx)("strong",{children:i({id:"pages.dataCollection.operation.deviceConfig.autoPairingGuideLogic"})})}),(0,e.jsxs)("ul",{children:[(0,e.jsxs)("li",{children:[(0,e.jsx)("strong",{children:i({id:"pages.dataCollection.operation.deviceConfig.autoPairingGuideLogicSingleDeviceDesc"})}),i({id:"pages.dataCollection.operation.deviceConfig.autoPairingGuideLogicSingleDevice"})]}),(0,e.jsxs)("li",{children:[(0,e.jsx)("strong",{children:i({id:"pages.dataCollection.operation.deviceConfig.autoPairingGuideLogicDoubleDeviceDesc"})}),i({id:"pages.dataCollection.operation.deviceConfig.autoPairingGuideLogicDoubleDevice"})]})]})]})]})})})]})},Vn=Gn,Ke=function(n){return me().isString(n)?n.length===0:me().isObject(n)?me().isEmpty(Object.keys(n)):me().isArray(n)?me().isEmpty(n.length):me().isNil(n)},Le="localhost",Ie="8887",Oe="v0",Ut="http://".concat(Le,":").concat(Ie,"/api/").concat(Oe),ha=function(n){var a=n.title,d=n.value,y=n.bordered,b=useStyles(),R=b.styles;return _jsxs("div",{className:R.headerInfo,children:[_jsx("span",{children:a}),_jsx("p",{children:d}),y&&_jsx("em",{})]})},Xn=function(){var n=(0,G.useIntl)(),a=n.formatMessage,d=(0,r.useState)(K.Portable),y=C()(d,2),b=y[0],R=y[1],h=(0,r.useState)([]),P=C()(h,2),I=P[0],U=P[1],H=(0,r.useRef)(null),E=(0,r.useRef)(null),O=(0,r.useRef)(null),V=(0,r.useRef)(null),ie=(0,r.useRef)(0),ke=(0,r.useState)("idle"),fe=C()(ke,2),Ee=fe[0],J=fe[1],q=(0,r.useState)(!1),Pe=C()(q,2),We=Pe[0],i=Pe[1],Ne=(0,r.useState)(!1),Se=C()(Ne,2),m=Se[0],Ce=Se[1],oe=(0,r.useState)(),ve=C()(oe,2),ye=ve[0],je=ve[1],Je=(0,r.useState)(),Be=C()(Je,2),se=Be[0],_=Be[1],M=(0,r.useRef)(null),$e=(0,r.useRef)(null),ze=(0,r.useRef)(null),De=(0,r.useState)(null),Te=C()(De,2),le=Te[0],Ze=Te[1],j=(0,r.useRef)(null),ee=(0,r.useRef)(null),qe=(0,r.useState)([]),te=C()(qe,2),Ue=te[0],_e=te[1],ce=(0,r.useRef)(null),wt=(0,r.useState)(null),et=C()(wt,2),tt=et[0],he=et[1],W=(0,r.useRef)(null),ue=(0,r.useRef)(null),nt=(0,r.useState)(null),at=C()(nt,2),rt=at[0],Fe=at[1],kt=(0,r.useState)(null),it=C()(kt,2),Pt=it[0],ot=it[1],Dt=(0,r.useState)([]),st=C()(Dt,2),Tt=st[0],lt=st[1],Ht=(0,r.useState)([]),ct=C()(Ht,2),Qt=ct[0],g=ct[1],f=(0,r.useRef)(0),p=(0,r.useRef)(null),o=(0,r.useRef)(null),S=(0,r.useRef)(null),t=(0,r.useRef)(null),N=(0,r.useRef)(null),u=(0,r.useState)(!1),ut=C()(u,2),l=ut[0],Kn=ut[1],Jn=(0,r.useState)(!1),Gt=C()(Jn,2),Zt=Gt[0],qn=Gt[1],_n=(0,r.useState)(!1),Vt=C()(_n,2),He=Vt[0],ea=Vt[1],ta=xt(),be=ta.styles,Xt=(0,G.useRequest)(function(){return gn()}),ma=Xt.data,dt=Xt.loading,Qe=(0,r.useMemo)(function(){return function(A){var c,D,X,Y,ne,T,B,$=A.timestamp,z=A.data||[],Z=new Date($*1e3).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}),Q=[{id:"1",name:"\u5750\u6807X",value:((c=z[0])!==null&&c!==void 0?c:0).toFixed(4),time:Z},{id:"2",name:"\u5750\u6807Y",value:((D=z[1])!==null&&D!==void 0?D:0).toFixed(4),time:Z},{id:"3",name:"\u5750\u6807Z",value:((X=z[2])!==null&&X!==void 0?X:0).toFixed(4),time:Z}],de=[{id:"1",name:"QX",value:((Y=z[3])!==null&&Y!==void 0?Y:0).toFixed(4),time:Z},{id:"2",name:"QY",value:((ne=z[4])!==null&&ne!==void 0?ne:0).toFixed(4),time:Z},{id:"3",name:"QZ",value:((T=z[5])!==null&&T!==void 0?T:0).toFixed(4),time:Z},{id:"4",name:"QW",value:((B=z[6])!==null&&B!==void 0?B:0).toFixed(4),time:Z}];return{xyz:Q,q:de}}},[]),gt=50,Yt=1,Kt=function(){M.current&&(M.current.onerror=null,M.current.src="")},na=(0,r.useState)(0),Jt=C()(na,2),aa=Jt[0],pt=Jt[1];(0,r.useEffect)(function(){if(!m){N.current&&(N.current.close(),N.current=null),i(!1),J("idle"),U([]),Fe(null),lt([]),H.current=null;return}var A="ws://".concat(Le,":").concat(Ie,"/api/").concat(Oe,"/ws/slam_stream"),c=new WebSocket(A);return N.current=c,J("sse"),i(!1),c.onopen=function(){console.log("SLAM WebSocket Connected"),i(!0)},c.onmessage=function(D){try{var X=JSON.parse(D.data);X.type==="slam"&&(H.current=X)}catch(Y){console.error("Failed to parse SLAM WebSocket message",Y)}},c.onerror=function(D){console.error("SLAM WebSocket Error:",D),x.ZP.error("SLAM WebSocket \u8FDE\u63A5\u5931\u8D25\u3002"),i(!1)},c.onclose=function(){console.log("SLAM WebSocket Disconnected"),i(!1),N.current=null},function(){c.readyState===WebSocket.OPEN&&c.close(),N.current=null}},[m,Qe]),(0,r.useEffect)(function(){if(!m){ee.current&&(ee.current.close(),ee.current=null),j.current&&(URL.revokeObjectURL(j.current),j.current=null),Ze(null),E.current=null;return}var A="ws://".concat(Le,":").concat(Ie,"/api/").concat(Oe,"/ws/tof_stream"),c=new WebSocket(A);return ee.current=c,c.binaryType="arraybuffer",c.onopen=function(){console.log("TOF Image WebSocket Connected")},c.onmessage=function(D){E.current=D.data},c.onerror=function(D){console.error("TOF Image WebSocket Error:",D),x.ZP.error("TOF Image WebSocket \u8FDE\u63A5\u5931\u8D25\u3002")},c.onclose=function(){console.log("TOF Image WebSocket Disconnected"),ee.current=null},function(){c.readyState===WebSocket.OPEN&&c.close(),ee.current=null,j.current&&(URL.revokeObjectURL(j.current),j.current=null)}},[m]),(0,r.useEffect)(function(){if(!m){ce.current&&(ce.current.close(),ce.current=null),_e([]),ot(null),g([]),O.current=null;return}var A="ws://".concat(Le,":").concat(Ie,"/api/").concat(Oe,"/ws/right_slam_stream"),c=new WebSocket(A);return ce.current=c,c.onopen=function(){console.log("Right SLAM WebSocket Connected")},c.onmessage=function(D){try{var X=JSON.parse(D.data);O.current=X}catch(Y){console.error("Failed to parse Right SLAM WebSocket message",Y)}},c.onerror=function(D){console.error("Right SLAM WebSocket Error:",D),x.ZP.error("Right SLAM WebSocket \u8FDE\u63A5\u5931\u8D25\u3002")},c.onclose=function(){console.log("Right SLAM WebSocket Disconnected"),ce.current=null},function(){c.readyState===WebSocket.OPEN&&c.close(),ce.current=null}},[m,Qe]),(0,r.useEffect)(function(){if(!m){ue.current&&(ue.current.close(),ue.current=null),W.current&&(URL.revokeObjectURL(W.current),W.current=null),he(null),V.current=null;return}var A="ws://".concat(Le,":").concat(Ie,"/api/").concat(Oe,"/ws/right_tof_stream"),c=new WebSocket(A);return ue.current=c,c.binaryType="arraybuffer",c.onopen=function(){console.log("Right TOF Image WebSocket Connected")},c.onmessage=function(D){V.current=D.data},c.onerror=function(D){console.error("Right TOF Image WebSocket Error:",D),x.ZP.error("Right TOF Image WebSocket \u8FDE\u63A5\u5931\u8D25\u3002")},c.onclose=function(){console.log("Right TOF Image WebSocket Disconnected"),ue.current=null},function(){c.readyState===WebSocket.OPEN&&c.close(),ue.current=null,W.current&&(URL.revokeObjectURL(W.current),W.current=null)}},[m]),(0,r.useEffect)(function(){var A=function(){var Y=ae()(F()().mark(function ne(T,B,$,z){var Z,Q,de,Ge;return F()().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(!B.current){w.next=3;break}return console.log("[WebRTC ".concat(T,"] Already connected.")),w.abrupt("return");case 3:return console.log("[WebRTC ".concat(T,"] 1. Creating PeerConnection")),Z=new RTCPeerConnection,B.current=Z,Z.ontrack=function(ft){console.log("[WebRTC ".concat(T,"] 4. Received remote track")),$.current&&ft.streams[0]&&($.current.srcObject=ft.streams[0],console.log("[WebRTC ".concat(T,"] 5. Attached track to <video> element")))},Z.onconnectionstatechange=function(){console.log("[WebRTC ".concat(T,"] Connection state: ").concat(Z.connectionState)),(Z.connectionState==="failed"||Z.connectionState==="closed"||Z.connectionState==="disconnected")&&c(T,B,$)},w.prev=8,Z.addTransceiver("video",{direction:"recvonly"}),console.log("[WebRTC ".concat(T,"] 2. Creating Offer")),w.next=13,Z.createOffer();case 13:return Q=w.sent,w.next=16,Z.setLocalDescription(Q);case 16:return console.log("[WebRTC ".concat(T,"] 3. Sending Offer to server...")),w.next=19,fetch(z,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sdp:Q.sdp,type:Q.type})});case 19:if(de=w.sent,de.ok){w.next=22;break}throw new Error("Server responded with ".concat(de.status));case 22:return w.next=24,de.json();case 24:return Ge=w.sent,console.log("[WebRTC ".concat(T,"] 6. Received server Answer")),w.next=28,Z.setRemoteDescription(new RTCSessionDescription(Ge));case 28:console.log("[WebRTC ".concat(T,"] 7. Set remote Answer. Connection established!")),w.next=36;break;case 31:w.prev=31,w.t0=w.catch(8),console.error("[WebRTC ".concat(T,"] Failed to start:"),w.t0),x.ZP.error("WebRTC (".concat(T,") connection failed: ").concat(w.t0.message)),c(T,B,$);case 36:case"end":return w.stop()}},ne,null,[[8,31]])}));return function(T,B,$,z){return Y.apply(this,arguments)}}(),c=function(ne,T,B){var $=T.current;$&&(console.log("[WebRTC ".concat(ne,"] Stopping connection...")),$.close(),T.current=null),B.current&&(B.current.srcObject=null)};if(m){var D=window.location.hostname,X=Ut||"http://".concat(D,":8887/api/v0");Ke(ye)||A("left",p,S,"".concat(X,"/webrtc/offer/left")),Ke(se)||A("right",o,t,"".concat(X,"/webrtc/offer/right"))}return function(){c("left",p,S),c("right",o,t)}},[m]),(0,r.useEffect)(function(){if(m){var A,c=function D(){ie.current+=1;var X=1,Y=ie.current%X===0;if(H.current){var ne=H.current,T={timestamp:ne.timestamp,data:ne.data},B=Qe(T),$=B.xyz,z=B.q,Z=[{X:$[0].value,Y:$[1].value,Z:$[2].value,QX:z[0].value,QY:z[1].value,QZ:z[2].value,QW:z[3].value,time:$[0].time}],Q=Z[0],de=new pe.Pa4(parseFloat(Q.Y||"0"),parseFloat(Q.Z||"0"),parseFloat(Q.X||"0")),Ge=new pe._fP(parseFloat(Q.QX||"0"),parseFloat(Q.QY||"0"),parseFloat(Q.QZ||"0"),parseFloat(Q.QW||"1"));if(Fe({position:de,quaternion:Ge}),Y&&U(Z),f.current+=1,f.current%Yt===0){var _t={position:de,quaternion:Ge};lt(function(Ft){return[].concat(Mt()(Ft),[_t]).slice(-gt)})}H.current=null}if(O.current){var w=O.current,ft={timestamp:w.timestamp,data:w.data},en=Qe(ft),vt=en.xyz,ht=en.q,tn=[{X:vt[0].value,Y:vt[1].value,Z:vt[2].value,QX:ht[0].value,QY:ht[1].value,QZ:ht[2].value,QW:ht[3].value,time:vt[0].time}],xe=tn[0],nn=new pe.Pa4(parseFloat(xe.Y||"0"),parseFloat(xe.Z||"0"),parseFloat(xe.X||"0")),an=new pe._fP(parseFloat(xe.QX||"0"),parseFloat(xe.QY||"0"),parseFloat(xe.QZ||"0"),parseFloat(xe.QW||"1"));if(ot({position:nn,quaternion:an}),Y&&_e(tn),f.current+=1,f.current%Yt===0){var oa={position:nn,quaternion:an};g(function(Ft){return[].concat(Mt()(Ft),[oa]).slice(-gt)})}O.current=null}if(E.current&&!Ke(ye)){var sa=new Blob([E.current],{type:"image/jpeg"}),rn=URL.createObjectURL(sa);Ze(rn),j.current&&URL.revokeObjectURL(j.current),j.current=rn,E.current=null}if(V.current&&!Ke(se)){var la=new Blob([V.current],{type:"image/jpeg"}),on=URL.createObjectURL(la);he(on),W.current&&URL.revokeObjectURL(W.current),W.current=on,V.current=null}A=requestAnimationFrame(D)};return A=requestAnimationFrame(c),function(){cancelAnimationFrame(A),j.current&&URL.revokeObjectURL(j.current),W.current&&URL.revokeObjectURL(W.current)}}},[m,Qe]),(0,r.useEffect)(function(){if(m)m&&!l?pt(1):m&&l&&pt(2);else{Kt(),pt(0);return}return function(){Kt()}},[m,l]);var qt=[{title:a({id:"pages.dataCollection.table.time"}),dataIndex:"time",key:"time",align:"left"},{title:a({id:"pages.dataCollection.table.coordinate"})+"X",dataIndex:"X",key:"X",align:"left"},{title:a({id:"pages.dataCollection.table.coordinate"})+"Y",dataIndex:"Y",key:"Y",align:"left"},{title:a({id:"pages.dataCollection.table.coordinate"})+"Z",dataIndex:"Z",key:"Z",align:"left"},{title:"QX",dataIndex:"QX",key:"QX",align:"left"},{title:"QY",dataIndex:"QY",key:"QY",align:"left"},{title:"QZ",dataIndex:"QZ",key:"QZ",align:"left"},{title:"QW",dataIndex:"QW",key:"QW",align:"left"}],Sa=function(){console.log("Abnormal Stop button clicked"),x.ZP.error("\u6267\u884C\u5F02\u5E38\u505C\u6B62\uFF01")},ra=(0,e.jsxs)("div",{children:[He===!1&&(0,e.jsxs)("div",{children:[(0,e.jsx)(G.FormattedMessage,{id:"pages.dataCollection.deviceStatus"}),"\uFF1A",(0,e.jsx)(G.FormattedMessage,{id:"pages.dataCollection.deviceStatus.stopped"})," ",(0,e.jsx)(It.Z,{status:"error"})]}),He===!0&&(0,e.jsxs)("div",{children:[(0,e.jsx)(G.FormattedMessage,{id:"pages.dataCollection.deviceStatus"}),"\uFF1A",(0,e.jsx)(G.FormattedMessage,{id:"pages.dataCollection.deviceStatus.started"})," ",(0,e.jsx)(It.Z,{status:"success"})]})]}),ia=(0,r.useMemo)(function(){return m||dt||He||Zt},[m,dt,He,Zt]);return(0,e.jsx)(Tn,{value:{},children:(0,e.jsxs)(dn._z,{title:ra,children:[(0,e.jsx)(Dn,{disabled:ia,value:b,onChange:function(c){R(c)}}),(0,e.jsx)(Vn,{version:b,connect:m,connMode:Ee,connOk:We,isStarting:Zt,deviceStarted:He,recording:l,currentStep:aa,setConnect:Ce,setConnMode:J,setConnOk:i,setIsStarting:qn,setDeviceStarted:ea,setRecording:Kn,setVersion:R,leftSN:ye,setLeftSN:je,rightSN:se,setRightSN:_,setCurrentStep:pt}),(0,e.jsxs)(ge.Z,{title:a({id:"pages.dataCollection.visualization"}),variant:"borderless",style:{marginTop:8},children:[(0,e.jsx)(ge.Z,{variant:"borderless",style:{marginTop:0},bodyStyle:{padding:0},children:(0,e.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",columnGap:0,rowGap:0,gap:24,alignItems:"start"},children:[(0,e.jsxs)(ge.Z,{variant:"borderless",style:{marginTop:0},bodyStyle:{padding:0},children:[(0,e.jsx)(Ve.Z,{title:a({id:"pages.dataCollection.visualization.leftHandRGB"}),size:"small",style:{marginBottom:0},styles:{header:{marginBottom:8,padding:"0 8px"},content:{margin:0,padding:0}},children:(0,e.jsxs)("div",{style:{width:"100%",paddingTop:"56.25%",backgroundColor:"black",position:"relative"},children:[(0,e.jsx)("video",{ref:S,autoPlay:!0,playsInline:!0,muted:!0,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"contain",display:m?"block":"none"}}),!m&&(0,e.jsx)("div",{className:be.loadingMask,children:(0,e.jsxs)("span",{style:{fontSize:15},children:[a({id:"pages.dataCollection.visualization.unconnectedDesc"})," ",(0,e.jsx)("br",{}),a({id:"pages.dataCollection.visualization.connectDeviceDesc"})]})})]})}),(0,e.jsx)(Ve.Z,{title:"\u5DE6\u624B-TOF",size:"small",style:{marginBottom:0},styles:{header:{marginBottom:8,padding:"0 8px"},content:{margin:0,padding:0}},children:(0,e.jsx)("div",{style:{width:"100%",paddingTop:"56.25%",backgroundColor:"black",position:"relative"},children:m&&le?(0,e.jsx)("img",{alt:"video-1-bottom",src:le,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"contain",backgroundColor:"black",display:"block"}}):(0,e.jsx)("div",{className:be.loadingMask,children:(0,e.jsx)("span",{style:{fontSize:15},children:m?a({id:"pages.dataCollection.visualization.waitingVideoStreamDesc"}):(0,e.jsxs)(e.Fragment,{children:[a({id:"pages.dataCollection.visualization.unconnectedDesc"})," ",(0,e.jsx)("br",{}),a({id:"pages.dataCollection.visualization.connectDeviceDesc"})]})})})})})]}),(0,e.jsxs)(ge.Z,{variant:"borderless",style:{marginTop:0},bodyStyle:{padding:0},children:[(0,e.jsx)(Ve.Z,{title:a({id:"pages.dataCollection.visualization.rightHandRGB"}),size:"small",style:{marginBottom:0},styles:{header:{marginBottom:8,padding:"0 8px"},content:{margin:0,padding:0}},children:(0,e.jsxs)("div",{style:{width:"100%",paddingTop:"56.25%",backgroundColor:"black",position:"relative"},children:[(0,e.jsx)("video",{ref:t,autoPlay:!0,playsInline:!0,muted:!0,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"contain",display:m?"block":"none"}}),!m&&(0,e.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",color:"white",lineHeight:"1.5",textAlign:"center"},children:(0,e.jsxs)("span",{style:{fontSize:15},children:[a({id:"pages.dataCollection.visualization.unconnectedDesc"})," ",(0,e.jsx)("br",{}),a({id:"pages.dataCollection.visualization.connectDeviceDesc"})]})})]})}),(0,e.jsx)(Ve.Z,{title:a({id:"pages.dataCollection.visualization.rightHandTOF"}),size:"small",style:{marginBottom:0},styles:{header:{marginBottom:8,padding:"0 8px"},content:{margin:0,padding:0}},children:(0,e.jsx)("div",{style:{width:"100%",paddingTop:"56.25%",backgroundColor:"black",position:"relative"},children:m&&tt?(0,e.jsx)("img",{src:tt,alt:"video-3-bottom",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"contain",backgroundColor:"black",display:"block"}}):(0,e.jsx)("div",{className:be.loadingMask,children:(0,e.jsx)("span",{style:{fontSize:15},children:m?a({id:"pages.dataCollection.visualization.waitingVideoStreamDesc"}):(0,e.jsxs)(e.Fragment,{children:[a({id:"pages.dataCollection.visualization.unconnectedDesc"})," ",(0,e.jsx)("br",{}),a({id:"pages.dataCollection.visualization.connectDeviceDesc"})]})})})})})]})]})}),(0,e.jsxs)(Re.Z,{gutter:24,children:[(0,e.jsxs)(k.Z,{span:12,children:[(0,e.jsx)("div",{className:be.title,style:{marginTop:24},children:a({id:"pages.dataCollection.visualization.leftHandSLAM3D"})}),(0,e.jsx)(ge.Z,{style:{height:400,marginBottom:24,padding:0},styles:{body:{padding:0,height:"100%"}},children:(0,e.jsx)(Et,{currentPose:rt,history:Tt,trajectoryLength:gt})}),(0,e.jsx)("div",{className:be.title,style:{marginTop:24},children:a({id:"pages.dataCollection.visualization.leftHandSLAMData"})}),(0,e.jsx)(Lt.Z,{style:{marginBottom:24,width:"100%"},pagination:!1,search:!1,loading:dt,options:!1,toolBarRender:!1,dataSource:I,columns:qt,rowKey:"time"})]}),(0,e.jsxs)(k.Z,{span:12,children:[(0,e.jsx)("div",{className:be.title,style:{marginTop:24},children:a({id:"pages.dataCollection.visualization.rightHandSLAM3D"})}),(0,e.jsx)(ge.Z,{style:{height:400,marginBottom:24,padding:0},styles:{body:{padding:0,height:"100%"}},children:(0,e.jsx)(Et,{currentPose:Pt,history:Qt,trajectoryLength:gt})}),(0,e.jsx)("div",{className:be.title,style:{marginTop:24},children:a({id:"pages.dataCollection.visualization.rightHandSLAMData"})}),(0,e.jsx)(Lt.Z,{style:{marginBottom:24,width:"100%"},pagination:!1,search:!1,loading:dt,options:!1,toolBarRender:!1,dataSource:Ue,columns:qt,rowKey:"time"})]})]})]})]})})},Yn=Xn}}]);
